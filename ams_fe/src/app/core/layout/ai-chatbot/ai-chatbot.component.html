<div class="fixed right-0 top-0 h-screen w-[480px] bg-white shadow-2xl flex flex-col border-l border-gray-200 z-50">
  <div class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-6 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
        <lucide-icon name="sparkles" class="w-6 h-6 text-purple-600"></lucide-icon>
      </div>
      <div>
        <h2 class="text-xl font-semibold">AI Assistant</h2>
        <p class="text-sm text-purple-100">Powered by AMS Intelligence</p>
      </div>
    </div>
    <button (click)="close.emit()" class="p-2 hover:bg-purple-500 rounded-lg transition-colors">
      <lucide-icon name="x" class="w-5 h-5"></lucide-icon>
    </button>
  </div>

  <div class="p-4 border-b border-gray-200 bg-purple-50">
    <p class="text-xs text-gray-600 mb-2 font-medium">Try asking:</p>
    <div class="flex flex-wrap gap-2">
      <button
        *ngFor="let suggestion of suggestions"
        (click)="handleSuggestionClick(suggestion)"
        class="px-3 py-1.5 bg-white border border-purple-200 text-purple-700 rounded-full text-xs hover:bg-purple-100 transition-colors"
      >
        {{ suggestion }}
      </button>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50">
    <div *ngFor="let message of messages" class="flex" [ngClass]="message.type === 'user' ? 'justify-end' : 'justify-start'">
      <div *ngIf="message.type === 'ai'" class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
        <lucide-icon name="sparkles" class="w-4 h-4 text-white"></lucide-icon>
      </div>

      <div class="max-w-[80%]" [ngClass]="message.type === 'user' ? 'order-1' : ''">
        <div *ngIf="message.type === 'loading'" class="bg-gray-100 rounded-2xl px-4 py-3">
          <div class="flex items-center gap-2 text-gray-600">
            <div class="w-2 h-2 bg-purple-600 rounded-full animate-pulse"></div>
            <span class="text-sm italic">{{ message.content }}</span>
          </div>
        </div>

        <div
          *ngIf="message.type !== 'loading'"
          class="rounded-2xl px-4 py-3"
          [ngClass]="message.type === 'user' ? 'bg-blue-600 text-white' : 'bg-white text-gray-900 border border-gray-200'"
        >
          <p class="text-sm">{{ message.content }}</p>

          <div *ngIf="message.data?.type === 'table'" class="mt-3 bg-gray-50 rounded-lg overflow-hidden border border-gray-200">
            <table class="w-full text-sm">
              <thead class="bg-gray-100">
                <tr>
                  <th class="text-left px-3 py-2 text-xs font-medium text-gray-600">Name</th>
                  <th class="text-left px-3 py-2 text-xs font-medium text-gray-600">Time</th>
                  <th class="text-left px-3 py-2 text-xs font-medium text-gray-600">Late By</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr *ngFor="let row of message.data.rows" class="hover:bg-gray-50">
                  <td class="px-3 py-2 text-gray-900">{{ row.name }}</td>
                  <td class="px-3 py-2 font-mono text-gray-900">{{ row.time }}</td>
                  <td class="px-3 py-2 text-yellow-600 font-medium">{{ row.late }}</td>
                </tr>
              </tbody>
            </table>
            <div class="px-3 py-2 bg-gray-100 border-t border-gray-200 flex gap-2">
              <button class="text-xs text-blue-600 hover:underline flex items-center gap-1">
                <lucide-icon name="send" class="w-3 h-3"></lucide-icon>
                Send Reminder to All
              </button>
            </div>
          </div>

          <div *ngIf="message.data?.type === 'chart'" class="mt-3 bg-gray-50 rounded-lg p-4 border border-gray-200">
            <div class="h-32 flex items-end justify-between gap-1">
              <div *ngFor="let height of message.data.values; let i = index" class="flex-1 flex flex-col items-center">
                <div
                  class="w-full rounded-t transition-all"
                  [ngClass]="i === 6 ? 'bg-gray-200' : 'bg-purple-600'"
                  [ngStyle]="{ height: height + '%' }"
                ></div>
                <span class="text-xs text-gray-600 mt-1">{{ ['M', 'T', 'W', 'T', 'F', 'S', 'S'][i] }}</span>
              </div>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200">
              <button class="text-xs text-blue-600 hover:underline flex items-center gap-1">
                <lucide-icon name="pin" class="w-3 h-3"></lucide-icon>
                Pin to Dashboard
              </button>
            </div>
          </div>

          <div *ngIf="message.data?.type === 'list'" class="mt-3 bg-gray-50 rounded-lg overflow-hidden border border-gray-200 divide-y divide-gray-200">
            <div *ngFor="let item of message.data.items" class="px-3 py-2.5 hover:bg-gray-100">
              <div class="flex items-start justify-between">
                <div>
                  <p class="text-sm font-medium text-gray-900">{{ item.name }}</p>
                  <p class="text-xs text-gray-600">{{ item.type }} - {{ item.days }}</p>
                  <p class="text-xs text-gray-600 mt-0.5">{{ item.dates }}</p>
                </div>
                <button class="text-xs text-green-600 hover:underline">Approve</button>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="message.type === 'ai' && !message.data" class="flex items-center gap-3 mt-2 ml-2">
          <button class="p-1 hover:bg-gray-200 rounded transition-colors" title="Helpful">
            <lucide-icon name="thumbs-up" class="w-3.5 h-3.5 text-gray-600"></lucide-icon>
          </button>
          <button class="p-1 hover:bg-gray-200 rounded transition-colors" title="Not helpful">
            <lucide-icon name="thumbs-down" class="w-3.5 h-3.5 text-gray-600"></lucide-icon>
          </button>
          <span class="text-xs text-gray-400">
            {{ message.timestamp | date: 'hh:mm a' }}
          </span>
        </div>
      </div>

      <div *ngIf="message.type === 'user'" class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center ml-3 flex-shrink-0 text-white text-sm font-medium">
        AU
      </div>
    </div>
    <div #messagesEnd></div>
  </div>

  <div class="p-4 border-t border-gray-200 bg-white">
    <div class="flex gap-2">
      <input
        type="text"
        [value]="input"
        (input)="input = $any($event.target).value"
        (keypress)="handleKeyPress($event)"
        placeholder="Ask about attendance, trends, or employees..."
        class="flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
        [disabled]="isLoading"
      />
      <button
        (click)="handleSend()"
        [disabled]="!input.trim() || isLoading"
        class="px-5 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <lucide-icon name="send" class="w-5 h-5"></lucide-icon>
      </button>
    </div>
    <p class="text-xs text-gray-600 mt-2 text-center">
      AI can make mistakes. Verify important information.
    </p>
  </div>
</div>
